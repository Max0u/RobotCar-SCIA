#! /usr/bin/python3

from simulator import Simulator
from colors import White, DarkShadow, Yellow
from layers import Background, DrawLines, Perspective, Crop, Symmetric, DrawLinesStraight
from noise import Shadows, Filter, NoiseLines, Enhance

white = White()
yellow = Yellow()
shadow = DarkShadow()

def generate(n_examples, straight=False):

    simulator = Simulator()

    # background (top view)
    #  -> nb background
    #  -> nb rotations
    #  -> nb crop
    #  -> nb resize
    simulator.add(Background(n_backgrounds=50,
                             n_rot=5,
                             n_crop=5,
                             n_res=5,
                             path='../ground_pics',
                             input_size=(250, 200)))

    if not straight:

        """ LAYERS """

        # draw lines
        #  -> thickness
        #  -> color
        #  -> radius
        simulator.add(DrawLines(input_size=(250, 200),
                                color_range=white, 
                                middle_line=(20, 50, "dashed", yellow),
                                thickness_range=[5, 6, 7, 8, 9],
                                target_ratio=0))

        # add perspective
        simulator.add(Perspective())

        # remove empty space generated by perspective
        simulator.add(Crop())

        # duplicate each image and mirror
        simulator.add(Symmetric())


        """ NOISES """
        # add shadow
        simulator.add(Shadows(colors=shadow))

        # blur + gauss_blur + smooth + smooth_more + rank_filter <= 1
        simulator.add(Filter(blur=0.1, smooth=0.1, smooth_more=0.1, rank_filter=0.1))

        # brightness + contrast + sharpness <= 1
        simulator.add(Enhance(brightness=0.1, contrast=0.1, sharpness=0.1))

    else:

        """ LAYERS """

        # draw lines
        #  -> thickness
        #  -> color
        #  -> radius
        simulator.add(DrawLinesStraight(middle_line=(20, 50, "dashed", yellow),
                                        thickness_range=[5, 6, 7, 8, 9],
                                        color=white))

        # add perspective
        simulator.add(Perspective())

        # remove empty space generated by perspective
        simulator.add(Crop())

        """ NOISES """
        # add shadow
        simulator.add(Shadows(colors=shadow))

        # blur + gauss_blur + smooth + smooth_more + rank_filter <= 1
        simulator.add(Filter(blur=0.1, smooth=0.1, smooth_more=0.1, rank_filter=0.1))

        # brightness + contrast + sharpness <= 1
        simulator.add(Enhance(brightness=0.1, contrast=0.1, sharpness=0.1))



    """ GENERATE """
    simulator.generate(n_examples=n_examples, path='dataset_simulator')

if __name__ == '__main__':

    """
    /!\Â Note that the non straight generator will generate 2 times the number of
        images asked for because of the symmetric layer so if you write 200 it
        will generate 400. IT IS NOT THE CASE FOR THE STRAIGHT GENERATOR.
    """

    generate(10000, straight=False)
    generate(5000, straight=True)

